<!doctype html>
<html>
<head><title>MATAMARCIANOS THE GAME </title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js"></script>

</head>

<body>

	<h1>Bienvenido/a al juego de los marcianos</h1>

	<script>
		let game_w = 800;
		let game_h = 600;
		
		let bg_img;
		let pj_img;
		let pj_bullet;
		let enm_img;
		let enm2_img;
		let enm3_img;
		
		let position_enm1_x = 890;
		let position_enm2_x = 1850;
		let position_enm3_x = 1350;

		let	cursors;
		let spaceKey;
		let speed = 3;
		let enemySpeed = 2;
		
		let lives = 3;
		let lives_text;
		let score = 0;
		let score_text;
	
	    let positions = [position_enm1_x, position_enm2_x, position_enm3_x];
		let enemies =[];
		let bullets=[];
		
		let speedBullet = 1;

		let inGame = false;

		let config = {
		width: game_w,
		height: game_h,
		physics:{
			default:'arcade',
		    arcade:{
		    debug: true
		    }
	    },
		scene: {
		    preload: preload,
		    create: create,
		    update: update
		}
		};
		
		let game = new Phaser.Game(config);
		
		function collisionEnemy(){
			enemies[0].x = position_enm1_x;
			enemies[1].x = position_enm2_x;
			enemies[2].x = position_enm3_x;
		}

		function collisionWall(enemy, position){
			if(enemy.x < game_w-780){
				enemy.x = position;
				lives--;
            	lives_text.text = lives.toString();
			}
		}

		function preload(){
			this.load.image ("espacio", "Background.png");
			this.load.image ("player", "Nave.png");	
			this.load.image ("pj_bullet", "BalaPlayer.png");
			this.load.image ("enemy", "NaveEnemigo.png");
		}

		function create(){
		
			bg_img = this.add.image(game_w/2 , game_h/2 , "espacio");
			pj_bullet = this.add.image(900, 900, "pj_bullet");
			pj_img = this.add.image(120, 300, "player"); 
			enemies[0] = this.add.image(position_enm1_x, 150, "enemy");
			enemies[1] = this.add.image(position_enm2_x, 300, "enemy");
			enemies[2] = this.add.image(position_enm3_x, 450, "enemy");

			this.physics.add.existing(pj_img, false);
			this.physics.add.existing(pj_bullet, false);
			this.physics.add.existing(enemies[0], false);
			this.physics.add.existing(enemies[1], false);
			this.physics.add.existing(enemies[2], false);
			
			pj_img.setScale(0.7);
			
			for (let i = 0; i < enemies.length; i++){
				enemies[i].setScale(0.7);
                    this.physics.add.collider(pj_img, enemies[i], function (){
                        collisionEnemy();
                        lives--;
                        lives_text.text = lives.toString();
                    });
					this.physics.add.collider(enemies[i], pj_bullet, function(){
                 		enemies[i].x = positions[i];
						pj_bullet.x = 2000;
                 		score ++;
                	 	score_text.text = score.toString();
             		});
			}

			this.add.text(game_w/2 - 350, 54, "LIVES: ");
			lives_text = this.add.text(game_w/2 - 350 + 64, 54, "3");
   		    this.add.text(game_w/2 - 350, 70, "POINTS: ");
            score_text = this.add.text(game_w/2 - 350 + 68, 70, "0");
		
			cursors = this.input.keyboard.createCursorKeys();
			graphics = this.add.graphics();

			this.spaceKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
		}

		function update(time, delta){

			if (cursors.up.isDown && pj_img.y > game_h-560){
				pj_img.y -= speed;
			}
			if (cursors.down.isDown && pj_img.y < game_h-40 ){
				pj_img.y += speed;
			}
			
			pj_bullet.x += speedBullet * delta;
			if (Phaser.Input.Keyboard.JustDown(this.spaceKey)){
				pj_bullet.x = pj_img.x + 50;
				pj_bullet.y = pj_img.y;
			}
			
			enemies[0].x -= enemySpeed;
			enemies[1].x -= enemySpeed;
			enemies[2].x -= enemySpeed;

			collisionWall(enemies[0], position_enm1_x+500);
			collisionWall(enemies[1], position_enm2_x+100);
			collisionWall(enemies[2], position_enm3_x+300);
		}

	</script>

</body>
</html>
